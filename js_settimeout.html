<!DOCTYPE html>
<html lang="en">
    <head>
        <title>setTimeout() and setInterval() | JS CodeyLuwak</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/x-icon" href="./img/keyboard-5-16.ico">
        <link rel="stylesheet" href="./style.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,400;0,700;1,400;1,700&family=Fira+Mono:wght@400;500;700&family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    </head>

    <body>

        <header>
            <a href="./index.html"><h1>JavaScript: setTimeout() and setInterval()</h1></a>
            <nav id="navMenu"></nav>
        </header>

        <main class="js-notes">
            
            <article id="scheduling">
                <h2>Scheduling a call</h2>
                <dl>
                    <dt>2 methods:</dt>
                    <dd>
                        <ul>
                            <li><code>setTimeout()</code>: Run a function once after the time interval</li>
                            <li><code>setInterval()</code>: Run a function repeatedly. Starting after the time interval, and repeating with that time interval.</li>
                        </ul>
                    </dd>
                </dl>
                <a href="#top"><hr></a>
            </article>


            <article id="asynchronous">
                <h2>Asynchronous</h2>
                <dl>
                    <dt>Asynchronous function</dt>
                    <dd>Both are asynchronous functions. Meaning: the timer function will not pause execution of other functions in the function stack. It doesn't delay the start of the next timeout/interval.</dd>
                    <dd>
<pre class="formula-thin">
setInterval(() => {console.log("Tic")}, 1000)
setTimeout(() => {console.log("Message 1")}, 2000);
setTimeout(() => {console.log("Message 2")}, 4000);
setTimeout(() => {console.log("Message 3")}, 6000);
</pre>
                    </dd>
                    <dd>The message 1, 2, and 3 will appear at second 2, 4, and 6. Instead of 2, 6, and 12.</dd>
                    <dd>
<pre class="formula-thin">
Results:
Second 1: Tic
Second 2: Tic, Message 1
Second 3: Tic
Second 4: Tic, Message 2
Second 5: Tic
Second 6: Tic, Message 2
Second 7: Tic
Second 8: Tic (until cleared)
</pre>
                    </dd>
                    
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="set-timeout">
                <h2>setTimeout()</h2>
                <dl>
                    <dt><code>setTimeout()</code> syntax</dt>
                    <dd>
<pre class="formula">
setTimeout(<span class="variable">function</span>, <span class="variable">delayMs</span>, <span class="variable">...</span>)
</pre>
                    </dd>
                    <dd>This method calls a function after a number of milliseconds.</dd>

                    <dt>Arguments:</dt>
                    <dd>
                        <ul>
                            <li><b>Function</b> to execute (required). It can be a quoted code instead.
                                <ul>
                                    <li>Remember: Don't write the function with brackets <code>funcName()</code>, because it will run the code right away.</li>   
                                    <li>For function with parameters, how to include the parameters then if bracket not the way to go? List them as a comma-separated list after the time delay. See "other parameters" below.</li>                                 
                                </ul>
                            </li>
                            <li><b>Delay</b> in milliseconds (optional)
                                <ul>
                                    <li>Default value is 0. To be executed immediately (the next event cycle).</li>
                                    <li>Exact delay is not guaranteed
                                        <ul>
                                            <li>CPU overloaded</li>
                                            <li>Browser tab is in background mode</li>
                                            <li>laptop is on battery</li>
                                            <li>etc</li>
                                        </ul>
                                    </li>
                                    <li>Minimum delay time if 4 ms is enforced for 5th and above nested timeout and interval.</li>
                                    <li>If the delay is not in number, type coercion will be done to convert it.
                                                <ul>
                                                    <li><code>"1000"</code> is coerced into <code>1000</code></li>
                                                </ul>
                                            </li>
                                            <li>Don't rely on type coercion though.
                                                <ul>
                                                    <li><code>"1 second"</code> is coerced into 0</li>
                                                </ul>
                                            </li>
                                            <li>Just use number.</li>
                                        </ul>
                                    </li>
                                    <li>Maximum delay value
                                        <ul>
                                            <li>Browsers store delay as 32 bit signed integer internally. Interger above 2,147,483,647 ms (about 24.8 days) will cause integer overflow and as result, timeout will be executed immediately.</li>
                                        </ul>
                                        
                                    </li>
                                </ul>
                            </li>
                            <li><b>Other parameters</b> need to be passed to the function (optional). For example:
                                <ul>
                                    <li><code>function <span class="variable">greetName</span>(<span class="variable">phrase</span>, <span class="variable">name</span>) {...}</code></li>
                                    <li><code>setTimeout(<span class="variable">greetName</span>, 5000, <span class="variable">"The phrase"</span>, <span class="variable">"The name"</span>)</code></li>
                                </ul>
                            </li>
                        </ul>
                    </dd>

                    <dt>Return value:</dt>
                    <dd>A number, which is the id of the timer. Id is for use in <code>clearTimeout(id)</code> to cancel the timer.</dd>

                    <dt>Extended delays</dt>
                    
                    <dd>
                        <ul>
                            <li>Nested timeout/setinterval: minimum 4ms for 5th call and above</li>
                            <li>Timeout in inactive tabs</li>
                            <li>Throttling of tracking scripts</li>
                            <li>Late timeout</li>
                            <li>Deferral of timeouts during pageload</li>
                        </ul>
                    </dd>
                    <dd>Read more: <a href="https://developer.mozilla.org/en-US/docs/Web/API/setTimeout#reasons_for_delays_longer_than_specified:~:text=Timeouts%20in%20inactive%20tabs">MDN: Timeout in inactive tabs and more</a></dd>

                    <dt>Maximum delay value</dt>
                    <dd>Browsers store delay as 32 bit signed integer internally. Interger above 2,147,483,647 ms (about 24.8 days) will cause integer overflow and as result, timeout will be executed immediately.</dd>
                    <dd>
<pre class="formula-thin">
let counter = 0;
let tic = setInterval(() => {
counter ++;
console.log(counter);
}, 1000);
let underLimit = setTimeout(() => {
console.log("Under limit");
}, 2147483647)
let overLimit = setTimeout(() => {
console.log("Over limit");
}, 2147483648);
console.log(counter); 
</pre>
                    </dd>
                    <dd>
<pre class="formula-thin">
Result:
0
Over limit
1
2
3
... // the underlimit will get executed in 24-25 days if doesn't get truncated.
</pre>
                    </dd>
                    <dt>Simplest example:</dt>
                    <dd>
<pre class="formula-thin">
function <span class="variable">greetJello</span>() {
    <span class="codeblock">console.log("Hello, Jello!");</span>
} 

<b>setTimeout(</b><span class="variable">greetJello</span>, <span class="variable">5000</span><b>)</b>;
<span class="comment">// After 5 seconds: "Hello Jello!"</span>
</pre>
                    </dd>

                    <dt>Example inside function:</dt>
                    <dd>
<pre class="formula-thin">
function <span class="variable">greetLater</span>() {
    <span class="codeblock">setTimeout(greetNow, 5000);</span>
} 

function <span class="variable">greetNow</span>() {
    <span class="codeblock">alert("Greetings!");</span>
} 

greetNow();
<span class="comment">// Right away: "Greetings!"</span>

greetLater();
<span class="comment">// After 5 seconds: "Greetings!"</span>
</pre>
                    </dd>

                    <dt>Example with extra parameters:</dt>
                    <dd>
<pre class="formula-thin">
function <span class="variable">greetName</span>(<span class="variable">phrase</span>, <span class="variable">name</span>) {
    <span class="codeblock">console.log(phrase + ", " + name + "!");</span>
} 

<b>setTimeout(</b><span class="variable">greetName</span>, <span class="variable">5000</span>, <span class="variable">"Hi"</span>, <span class="variable">"Kitty"</span><b>)</b>;
<span class="comment">// After 5 seconds: "Hi, Kitty!"</span>
</pre>
                    </dd>

                    <dt>Don't use brackets: <code>setTimeout(<span class="variable">myFunction()</span>, 5000)</code></dt>
                    <dd>It's the same with calling a function. Function will be executed immediately instead of delayed.</dd>
                    <dd>
<pre class="formula-thin">
function <span class="variable">greetJello</span>() {
    <span class="codeblock">console.log("Hello, Jello!");</span>
} 

<b>setTimeout(</b><span class="variable">greetJello</span>, <span class="variable">5000</span><b>)</b>;
<span class="comment">// After 5 seconds: "Hello Jello!"</span>

<b>setTimeout(</b><span class="variable">greetJello()</span>, <span class="variable">5000</span><b>)</b>;
<span class="comment">// Right away: "Hello Jello!"</span>
</pre>
                    </dd>
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="quoted-code">
                <h2>setTimeout with quoted code (not recommended)</h2>
                <dl>                    

                    <dt><code>setTimeout</code> can be written with a quoted code directly</dt>
                    <dd>Syntax</dd>
                    <dd>
<pre class="formula">
setTimeout("<span class="variable">code</span>", <span class="variable">delayMS</span>, <span class="variable">...</span>)
</pre>
                    </dd>
                    <dt>Code must be quoted</dt>
                    <dd>
                        <ul>
                            <li>Why? <code>setTimeout</code> needs a reference to the code, not the code directly.</li>
                            <li>Without quotation, it's a code call. Will be executed right away.</li>
                            <li>Similarly, when function is use, we can't write the function with the brackets, because it will be a function call.</li>
                        </ul>
                    </dd>
                    <dt>Compare the wrong way</dt>
                    <dd>No delay. Code/function is called and executed right away.</dd>
                    <dd>
                        <ul>
                            <li><code>setTimeout(<span class="variable">alert("Hi")</span>, 5000)</code></li>
                            <li><code>setTimeout(<span class="variable">myFunction()</span>, 5000)</code></li>
                        </ul>
                    </dd>
                    <dt>Compare the right way</dt>
                    <dd>Code/function is referred.</dd>
                    <dd>
                        <ul>
                            <li><code>setTimeout(<span class="variable">"alert('Hi')"</span>, 5000)</code></li>
                            <li><code>setTimeout(<span class="variable">myFunction</span>, 5000)</code></li>
                        </ul>
                    </dd>

                    <dt>Example</dt>
                    <dd>
<pre class="formula-thin">
<b>setTimeout(</b><span class="variable">"alert('Hi!')"</span>, <span class="variable">5000</span><b>)</b>;
<span class="comment">// After 5 seconds: "Hi!"</span>
</pre>
                    </dd>
                    <dt>Quoted code not recommended: Use function</dt>
                    <dd>As an anonymous arrow function</dd>
                    <dd>
<pre class="formula-thin">
<b>setTimeout(</b><span class="variable">() => alert('Hi!')</span>, <span class="variable">5000</span><b>)</b>;
<span class="comment">// After 5 seconds: "Hi!"</span>
</pre>
                    </dd>
                </dl> 
                <a href="#top"><hr></a>
            </article>

            <article id="set-interval">
                <h2>setInterval</h2>
                <dl>       
                    <dt><code>setInterval()</code></dt>
                    <dd>Executing a function repeatedly with a given interval.</dd>                    

                    <dt>Syntax</dt>
                    <dd>Very similar to <code>setTimeout()</code></dd>
                    <dd>
<pre class="formula">
setInterval(<span class="variable">function</span>, <span class="variable">intervalMs</span>, <span class="variable">...</span>)
</pre>
                    </dd>
                    <dd>Check out <code>setTimeout()</code> for further arguments and return value.</dd>

                    <dt>First call</dt>
                    <dd>The first function call happened after the first time delay instead of before. This is like doing <code>setTimeout</code> but again and again.</dd>

                    <dt>Time goes on</dt>
                    <dd>Time goes on when running setInterval. The delay time marking the starting point of function call. In a run where user respond is required like alert, confirm, and prompt, it didn't wait for the user response to click to start delay count. The delay is to the start of the function call, not to the end of the function run.</dd>

                    <dt>Example: counter</dt>
                    <dd>
<pre class="formula-thin">
let <span class="variable">counter</span> = 0;
function <span class="variable">counterFn</span>() {
    counter++;
    console.log(counter);
}

const <span class="variable">myCounter</span> = setInterval(<span class="variable">counterFn</span>, <span class="variable">1000</span>);

<span class="comment">// 1 
// 2
// 3
// 4
// 5 (run continuously until cleared</span>

clearInterval(<span class="variable">myCounter</span>);   <span class="comment">// Execution cleared</span>
</pre>
                    </dd>


                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="clear-timeout-interval">
                <h2>clearTimeout and clearInterval</h2>
                <dl>
                    <dt><code>clearTimeout()</code> and <code>clearInterval()</code></dt>
                    <dd>These commands stops a running <b>timeout</b> or <b>interval</b>.</dd>
                    <dd>In the case of <b>timeout</b>, if it's run before the time delay is reached, it's essentially cancelling the <code>timeoutFn</code> from running.</dd>

                    <dt><code>clearTimeout()</code> syntax</dt>
                    <dd>
<pre class="formula">
const <span class="variable">timeoutId</span> = setTimeout(<span class="variable">timeoutFn</span>, <span class="variable">ms</span>)
<span class="comment">// return an id number, for example 1</span>

clearTimeout(<span class="variable">timeoutId</span>);
clearTimeout(<span class="variable">1</span>);
</pre>
                    </dd>

                    <dt><code>clearInterval()</code> syntax</dt>
                    <dd>
<pre class="formula">
const <span class="variable">intervalId</span> = setInterval(<span class="variable">intervalFn</span>, <span class="variable">ms</span>)
<span class="comment">// return an id number, for example 2</span>

clearInterval(<span class="variable">intervalId</span>);
clearInterval(<span class="variable">2</span>);
</pre>
                    </dd>

                    <dt>ID number</dt>
                    <dd>When a <code>setTimeout()</code> or <code>setInterval()</code> is run, it returns an <b>id</b>.</dd>
                    <dd>In most cases, this <b>id</b> is a consecutive <b>integer</b> start from <b>1</b>, give according to the order of the timeout/interval call.</dd>
                    <dd>This id number is what's used to clear the timeout/interval</dd>

                    <dt>Same ID pooling for both <code>setTimeout()</code> and <code>setInterval()</code></dt>
                    <dd>Example: when a webpage is opened:
                        <ul>
                            <li>First a <code>setTimeout()</code> is run. It gets id <code>1</code>.</li>
                            <li>Then a <code>setInterval()</code> is run. it gets id <code>2</code> eventhough it's the first interval to be run, because of the same numbering pooling with timeout counterpart.</li>
                        </ul>
                    </dd>

                    <dt>Assigned a constant for each id</dt>
                    <dd>Problem in using the id number directly:
                        <ul>
                            <li>Some browser gives different numbering system.
                                <ul>
                                    <li>Some starts from 2 (Firefox, Opera)</li>
                                    <li>Some gives random 6-digit number (IE)</li>
                                    <li>Some starts over when a new tab is opened (Opera), and some have a global count acrross the tabs opened (Safari).</li>
                                </ul>
                            </li>
                            <li>It's hard to know which one running first. Also when we tweak the code, we have to adjust all numbering accordingly? That's a very dangerous practise.</li>
                            <li>But even when we know exactly order of running. Or even more sure, we only have exactly 1 timeout/interval running. We still can't use it directly.</li>
                        </ul>
                    </dd>
                    <dd>What to do, then?
                        <ul>
                            <li>Assign a constant to the timeout and interval when we run it. As simple as:
                                <ul>
                                    <li><code>const timeoutId = setTimeout(fn, ms)</code></li>
                                    <li><code>const intervalId = setInterval(fn, ms)</code></li>
                                </ul>
                            </li>
                            <li>This way, those numbers, <code>1</code>, <code>2</code>, or even whatever random 6 digit number can be addressed as the constant name safely. We don't care the exact number. We refer it using the constant name.</li>
                        </ul>
                    </dd>

                    <dt><code>clearTimeout()</code> and <code>clearInterval()</code> are interchangable</dt>
                    <dd>Both can be used to clear both timeout and interval. However don't do this. It's a bad practise, it makes the code less readable.</dd>

                    <dt>Example</dt>
                    <dd>Use <code>clearTimeout()</code> to cancel a timeout function from running.</dd>
                    <dd>
<pre class="formula-thin">
const <span class="variable">timeoutId</span> = setTimeout(<span class="variable">() => console.log("Hello!")</span>, <span class="variable">5000</span>);

function <span class="variable">stopGreeting</span>() {
    clearTimeout(<span class="variable">timeoutId</span>);
}
  
<span class="variable">stopGreeting</span>();
// After 5 seconds: nothing
</pre>
                    </dd>
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="nested-timeout">
                <h2>Nested timeout</h2>
                <dl>       
                    <dt>Set interval with nested <code>setTimeout()</code></dt>
                    <dd>Timeout function is called from within the function itself.</dd>

                    <dt>Advantage over <code>setInterval</code></dt>
                    <dd>
                        <ul>
                            <li>Time delay can be manipulated</li>
                            <li>Delay is more realistic. It starts after the execution is finished instead of just working periodically. For a function that takes a long time to run, or waiting for user feedback for completion, this will be prominent.</li>
                        </ul>
                    </dd>

                    <dt><code>setInterval</code></dt>
                    <dd>
<pre class="formula">
let <span class="variable">idName</span> = setInterval(<span class="variable">() => alert("Next alert in 2 seconds. Agree?")</span>, <span class="variable">2000</span>);
</pre>
                    </dd>

                    <dt>Nesting <code>setTimeout()</code></dt>
                    <dd>
<pre class="formula">
let <span class="variable">idName</span> = setTimeout(<span class="thin">function <span class="variable">fnName</span>() {
    alert("Next alert in 2 seconds. Agree?");    
    <b style="border: 2px solid palegoldenrod;"><span class="variable">idName</span> = setTimeout(<span class="variable">fnName</span>, <span class="variable">2000</span>);</b>
}</span>, <span class="variable">2000</span>);</span>
</pre>
                    </dd>

                    <dt>Compare the two above</dt>
                    <dd>Try to wait for 10 seconds to click the <b>OK</b>.
                        <ul>
                            <li><code>setInterval</code>: jammed. Alert messages have been waiting.</li>
                            <li>Nested <code>setTimeout</code>: Nicely distanced 2 seconds apart from clicking.</li>

                        </ul>
                    </dd>

                    <dt>User can even decide the delay in nesting <code>setTimeout()</code></dt>
                    <dd>
<pre class="formula">
let <span class="variable">idName</span> = setTimeout(<span class="thin">function <span class="variable">fnName</span>() {
    let delay = prompt(`Next alert in how many seconds?
Max = 5s
Default = 1s`);
    if (delay === null) {
        return;
    } else if (!(delay &gt;= 0 && delay &lt;= 5)) {
        delay = 1;
    }
    <b style="border: 2px solid palegoldenrod;"><span class="variable">idName</span> = setTimeout(<span class="variable">fnName</span>, <span class="variable">delay*1000</span>);</b>
}</span>, <span class="variable">1000</span>);</span>
</pre>
                    </dd>

                    <dt>Example with time delay manipulation</dt>
                    <dd>Fire request every 1 second. But if request is rejected due to server overload, double the time delay from the last. Give up if delay is larger than 2 minutes.</dd>
                    <dd>
<pre class="formula-thin">
let delay = 0;
let reject = true;
let maxDelay = 15000;

let requestId = setTimeout(function request() {
    if (reject) {
        console.log(`Request rejected. Last waiting time: ${delay/1000} s.`)
        if (delay &lt; maxDelay) {
            delay = delay + 5000;
            console.log(`Resend request in ${delay/1000} s.`);
            let counter = 0;
            let counterId = setInterval(() => {
                counter ++;
                console.log(counter);
            }, 1000)
            let stopCount = setTimeout(() => {
                clearInterval(counterId);
            }, delay)
            requestId = setTimeout(request, delay);
        } else {
            console.log(`Max waiting time ${maxDelay/1000} s. Request cancelled. `);
            clearTimeout(requestId);
        } 
        
    } else {
        console.log("Request fulfilled. Request function is stopped.");
        clearTimeout(requestId);
    }
}, delay);
</pre>
                    </dd>
                    <dd>For fun, interject with:
                        <ul>
                            <li><code>reject = false;</code></li>
                            <li><code>maxDelay = 10000;</code></li>
                        </ul>
                    </dd>

                    <dt>Nested timeout get closed properly? No</dt>
                    <dd><b>Uncaught RangeError: Maximum call stack size exceeded</b></dd>
                    <dd>Let's do simple "Hi" with zero delay to be extreme</dd>
                    <dd>
<pre class="formula-thin">
let nestLimit = setTimeout(function hi() {
    console.log(`Hi`);
    nestLimit = setTimeout(hi())
})

let intLimit = setInterval(function hi() {
    console.log(`Hi`);
})
</pre>
                    </dd>
                    <dd>Results</dd>
                    <dd>
<pre class="formula-thin">
<b>Nested setTimeout</b>
// (10296) Hi
// <b>Uncaught RangeError: Maximum call stack size exceeded</b>

<b>Regular setInterval</b>
// (100K) Hi 
// ... and still going
</pre>
                    </dd>
                    <dd>Same result with delay 1ms, 2ms, 5ms, 10ms. Didn't try longer delay, do not want to wait longer.</dd>

                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="example-timer">
                <h2>Example: Timer with counter and cancel button</h2>
                <dl>     
                    <dt>About</dt>
                    <dd>Timer with counter and cancel button</dd>

                    <dt>Methods featured</dt>
                    <dd><code>setTimeout</code>, <code>setInterval</code>, <code>clearTimeout</code>, <code>clearInterval</code></dd>

                    <dt>Codes and result</dt>   
                    <dd>
                        <div class="js-resultbox">    
                            <div>
                                <label for="timeInput2">Enter time (0-60 seconds): </label>
                                <input type="text" id="timeInput2" value="3" size="2">
                                <input type="submit" id="timerButton2" value="Start timer">
                            </div>  
                            <p id="timerPar" style="display: none;"></p>
                            <p id="counterPar" style="display: none;"></p>
                            <p id="ringerPar" style="display: none;">Ring Ring Ring!</p>

                            <div id="cancelBox" style="display: none">
                                <input type="submit" id="cancelButton" value="Cancel timer">
                            </div>
                            <p id="cancelComment" style="display: none;">Timer cancelled.</p>
                            <div id="refreshBox" style="display: none">
                                <input type="submit" id="refreshButton" value="Refresh timer">
                            </div>
                            <script>   
                                let myTimer;
                                let myInterval;

                                function timerFunction2() {
                                    refreshTimer();                                    
                                    const timeLimit2 = document.getElementById("timeInput2").value;                                    

                                    if (timeLimit2 >= 0 && timeLimit2 <= 60) {
                                        let counterText = "";
                                        let counter = 0;
                                        document.getElementById("timerButton2").disabled = true;
                                        document.getElementById("timerPar").textContent = `Timer is set for ${timeLimit2} seconds.`;
                                        document.getElementById("timerPar").style.display = "block";
                                        document.getElementById("counterPar").textContent = counterText;
                                        document.getElementById("counterPar").style.display = "block";
                                        document.getElementById("cancelBox").style.display = "block";

                                        myInterval = setInterval(() => {
                                            counter ++;
                                            counterText += `${counter} `;
                                            document.getElementById("counterPar").textContent = counterText;
                                        }, 1000)

                                        myTimer = setTimeout(() => {
                                            clearInterval(myInterval);
                                            document.getElementById("ringerPar").style.display = "block";
                                            document.getElementById("cancelBox").style.display = "none";
                                            document.getElementById("refreshBox").style.display = "block";
                                            document.getElementById("timerButton2").disabled = false;
                                        }, timeLimit2*1000);
                                    } 
                                }

                                function cancelTimer() {
                                    clearTimeout(myTimer);
                                    clearInterval(myInterval);
                                    document.getElementById("cancelBox").style.display = "none";
                                    document.getElementById("cancelComment").style.display = "block";
                                    document.getElementById("refreshBox").style.display = "block";
                                    document.getElementById("timerButton2").disabled = false;
                                }

                                function refreshTimer() {
                                    document.getElementById("counterPar").textContent = "";
                                    document.getElementById("timerPar").textContent = "";
                                    document.getElementById("cancelBox").style.display = "none";
                                    document.getElementById("refreshBox").style.display = "none";
                                    document.getElementById("timerPar").style.display = "none";
                                    document.getElementById("counterPar").style.display = "none";
                                    document.getElementById("cancelComment").style.display = "none";
                                    document.getElementById("ringerPar").style.display = "none";
                                    document.getElementById("timerButton2").disabled = false;
                                }

                                document.getElementById("timerButton2").addEventListener("click", timerFunction2);
                                document.getElementById("cancelButton").addEventListener("click", cancelTimer);
                                document.getElementById("refreshButton").addEventListener("click", refreshTimer);
                            </script>
                        </div>
                        <div class="js-resultbox">
                            <details>
                                <summary>HTML codes</summary>
<pre>
&lt;div&gt;
    &lt;label for="timeInput2"&gt;Enter time (0-60 seconds): &lt;/label&gt;
    &lt;input type="text" id="timeInput2" value="3" size="2"&gt;
    &lt;input type="submit" id="timerButton2" value="Start timer"&gt;
&lt;/div&gt;  
&lt;p id="timerPar" style="display: none;"&gt;&lt;/p&gt;
&lt;p id="counterPar" style="display: none;"&gt;&lt;/p&gt;
&lt;p id="ringerPar" style="display: none;"&gt;Ring Ring Ring!&lt;/p&gt;

&lt;div id="cancelBox" style="display: none"&gt;
    &lt;input type="submit" id="cancelButton" value="Cancel timer"&gt;
&lt;/div&gt;
&lt;p id="cancelComment" style="display: none;"&gt;Timer cancelled.&lt;/p&gt;
&lt;div id="refreshBox" style="display: none"&gt;
    &lt;input type="submit" id="refreshButton" value="Refresh timer"&gt;
&lt;/div&gt;
</pre>
                            </details>
                            <details>
                                <summary>JS Codes</summary>
<pre>        
let myTimer;
let myInterval;

function timerFunction2() {
    refreshTimer();                                    
    const timeLimit2 = document.getElementById("timeInput2").value;                                    

    if (timeLimit2 >= 0 && timeLimit2 <= 60) {
        let counterText = "";
        let counter = 0;
        document.getElementById("timerButton2").disabled = true;
        document.getElementById("timerPar").textContent = `Timer is set for ${timeLimit2} seconds.`;
        document.getElementById("timerPar").style.display = "block";
        document.getElementById("counterPar").textContent = counterText;
        document.getElementById("counterPar").style.display = "block";
        document.getElementById("cancelBox").style.display = "block";

        myInterval = setInterval(() => {
            counter ++;
            counterText += `${counter} `;
            document.getElementById("counterPar").textContent = counterText;
        }, 1000)

        myTimer = setTimeout(() => {
            clearInterval(myInterval);
            document.getElementById("ringerPar").style.display = "block";
            document.getElementById("cancelBox").style.display = "none";
            document.getElementById("refreshBox").style.display = "block";
            document.getElementById("timerButton2").disabled = false;
        }, timeLimit2*1000);
    } 
}

function cancelTimer() {
    clearTimeout(myTimer);
    clearInterval(myInterval);
    document.getElementById("cancelBox").style.display = "none";
    document.getElementById("cancelComment").style.display = "block";
    document.getElementById("refreshBox").style.display = "block";
    document.getElementById("timerButton2").disabled = false;
}

function refreshTimer() {
    document.getElementById("counterPar").textContent = "";
    document.getElementById("timerPar").textContent = "";
    document.getElementById("cancelBox").style.display = "none";
    document.getElementById("refreshBox").style.display = "none";
    document.getElementById("timerPar").style.display = "none";
    document.getElementById("counterPar").style.display = "none";
    document.getElementById("cancelComment").style.display = "none";
    document.getElementById("ringerPar").style.display = "none";
    document.getElementById("timerButton2").disabled = false;
}

document.getElementById("timerButton2").addEventListener("click", timerFunction2);
document.getElementById("cancelButton").addEventListener("click", cancelTimer);
document.getElementById("refreshButton").addEventListener("click", refreshTimer);
</pre>
                            </details>
                        </div>
                    </div>
                    <dd>

                               
                    </dd>  
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="delay-0">
                <h2>Delay 0</h2>
                <dl>
                    <dt>Delay 0 (default)</dt>
                    <dd>It's possible to have delay = 0 ms. In fact, that's the default when delay parameter is not given. In this case, it will be running immediately without delay.</dd>

                    <dt><code>setTimeout(fn)</code></dt>
                    <dd>
<pre class="formula-thin">
setTimeout(() => console.log("Timeout with 0 delay"));
</pre>
                    </dd>

                    <dt><code>setInterval(fn)</code></dt>
                    <dd>Get ready for interval running very quicly and forever. Terminate with <code>clearInterval(id)</code></dd>
                    <dd>
<pre class="formula-thin">
let intZero = setInterval(() => {
    console.log("Interval with 0 delay. Terminate: clearInterval(intZero)");
});
</pre>
                    </dd>
                    <dt><code>setInterval(fn)</code> with auto-termination: internal counter</dt>
<dd>
<pre class="formula-thin">
let counter = 0;
let intZeroCount = setInterval(() => {
    counter ++;
    console.log("Interval with 0 delay. Auto-termination at 1000th run.");
    if (counter === 1000) {
        clearInterval(intZeroCount);
    }
});
</pre>
                    </dd>
                    <dt><code>setInterval(fn)</code> with auto-termination: external <code>setTimeout</code></dt>
                    <dd>
<pre class="formula-thin">
let intZeroTimed = setInterval(() => {
    console.log("Interval with 0 delay. Auto-termination at 2s with external setTimeout");
});

setTimeout(() => {
    clearInterval(intZeroTimed);
}, 2000)
</pre>
                    </dd>
                    <dt>4 milliseconds in browser</dt>
                    <dd>Timers can be nested; five and above such nested timers, however, the interval is forced to be at least four milliseconds.</dd>
                    <dd>Same true for setInterval</dd>
                    <dd>Why? Limitation happens on earlier time, and many scripts rely on it. So it is kept this way.</dd>
                    <dd>Such limitation doesn't exist in server-side Javascript. For doing proper <b>immediate asynchronous</b> job though, use other method, that's unfortunately rather browser-specific. Like <code>setImmediate</code> for <code>Node.js</code></dd>
                    <dd>
<pre class="formula-thin">
let start = Date.now();
let counter = 0;
let timeoutArray = [];
setTimeout(function check() {
    timeoutArray.push(Date.now() - start);
    start = Date.now();
    counter ++;
    if (counter < 20) {setTimeout(check)}
});

timeoutArray;
// (20) [2, 1, 1, 1, 4, 4, 5, 4, 4, 4, 5, 4, 4, 4, 5, 4, 4, 4, 5, 4]
</pre>
                    </dd>
                    <dd>Interval counterpart: similar</dd>
                    <dd>
<pre class="formula-thin">
let start = Date.now();
let counter = 0;
let intervalArray = [];
let intCheck = setInterval(function check() {
    intervalArray.push(Date.now() - start);
    counter ++;
    if (counter === 20) {clearInterval(intCheck)}
});

intervalArray;
// (20) [2, 0, 1, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
</pre>
                    </dd>
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="invocation-time">
                <h2>Invocation time</h2>
                <dl>

                    <dt>Invoked after current script execution is finished.</dt>
                    <dd>Whether the delay is zero or not, <code>setTimeout</code> and <code>setInterval</code> invocations are after the current script execution is finished.</dd>
                    
                    <dt>Consequence:</dt>
                    <dd>Even when <code>setTimeout</code> and <code>setInterval</code> are written first, it will have to wait the codes after to run.</dd>
                    
                    <dt>Simple example</dt>
                    <dd>
<pre class="formula-thin">
setTimeout(() => alert("Timeout"));
alert("Current script");
</pre>
                    </dd>

                    <dt>Fun example</dt>
                    <dd>See how <code>setTimeout</code> and <code>setInterval</code> are written first but run last.</dd>
                    <dd>
<pre class="formula-thin">
<span class="variable">// Code 1: setTimeout</span>
setTimeout(() => console.log("Code 1: Timeout set at 5000."),5000);

<span class="variable">// Code 2: setInterval</span>
counter = 0;
let intervalId = setInterval(() => {
    counter++;
    console.log("Code 2: Interval " + counter);
    if (counter === 10) {
        clearInterval(intervalId);
    }
}, 1000)

<span class="variable">// Code 3: plain console log</span>
console.log("Code 3: Plain console log run.");

<span class="variable">// Code 4: for-loop and result</span>
let i = 1;
for(i; i &lt;= 1000; i++) {
    i *= i
};
console.log("Code 4: For-loop multiplication = " + i);

<span class="variable">//Code 5: function</span>
function multiply(a, b) {
    return a*b;
}
console.log("Code 5: function multiply = " + multiply(100, 100))
</pre>
                    </dd>
                    <dd>Order of result in console:</dd>
                    <dd>
<pre class="formula-thin">
<span class="comment">Code 3: Plain console log run.
Code 4: For-loop multiplication = 458330
Code 5: function multiply = 10000
Code 2: Interval 1
Code 2: Interval 2
Code 2: Interval 3
Code 2: Interval 4
Code 1: Timeout set at 5000.
Code 2: Interval 5
Code 2: Interval 6
Code 2: Interval 7
Code 2: Interval 8
Code 2: Interval 9
Code 2: Interval 10</span>
</pre>
                    </dd>
                    <dd>If we switch code 1 and 2, into interval first, then in the result, timeout will appear after interval 5 as expected.</dd>

                    <dt>Compare: <code>setTimeout</code> outside function, inside function, and function without timeout</dt>
                    <dd>
<pre class="formula-thin">
setTimeout("console.log('Timeout outside function')", 5000);
function funcTimey() {
    setTimeout("console.log('Function with timeout inside')", 5000)
};
funcTimey();
function funcLoggy() {
    console.log('Function without timeout')
};
funcLoggy();
</pre>
                    </dd>
                    <dd>Order of result in console:</dd>
                    <dd>
<pre class="formula-thin">
<span class="comment">// Immediately</span>
Function without timeout  

<span class="comment">// The same time, after 5 seconds:</span>
Timeout outside function
Function with timeout inside
</pre>
                    </dd>

                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="example-counter">
                <h2>Example: Counter</h2>
                <dl>     
                    <dt>About</dt>
                    <dd>Counter with start and stop button</dd>
                    <dt>Codes and result</dt>
                    <dd>
                        <div class="js-resultbox">
                            <div>
                                <input type="button" id="startCounter" value="Start counting">
                                <input type="button" id="stopCounter" value="Stop counting">
                                <input type="button" id="backToZero" value="Back to Zero">
                            </div>                            
                            <div id="counterBox" size="5" style="font-size:2rem; color: pink;">0</div>
                            <script>
                                let coolCounter;
                                let number = 0;
                                let counterOn = false;

                                function startCount() {
                                    if (!counterOn) {
                                        coolCounter = setInterval(() => {
                                        number ++;
                                        document.getElementById("counterBox").textContent = number;
                                    }, 1000)
                                    }                                    
                                    counterOn = true;
                                }

                                function stopCount() {
                                    clearInterval(coolCounter);
                                    counterOn = false;
                                }

                                function zeroNumber() {
                                    clearInterval(coolCounter);
                                    counterOn = false;
                                    number = 0;
                                    document.getElementById("counterBox").textContent = number;
                                }

                                document.getElementById("startCounter").addEventListener("click", startCount);
                                document.getElementById("stopCounter").addEventListener("click", stopCount);
                                document.getElementById("backToZero").addEventListener("click", zeroNumber);
                            </script>
                        </div>
                        <div class="js-resultbox">
                            <details>
                                <summary>HTML Codes</summary>
<pre>
&lt;div&gt;
    &lt;input type="button" id="startCounter" value="Start counting"&gt;
    &lt;input type="button" id="stopCounter" value="Stop counting"&gt;
    &lt;input type="button" id="backToZero" value="Back to Zero"&gt;
&lt;/div&gt;                            
&lt;div id="counterBox" size="5" style="font-size:2rem; color: pink;"&gt;0&lt;/div&gt;
</pre>
                            </details>
                            <details>
                                <summary>JS Codes</summary>
<pre>
let coolCounter;
let number = 0;
let counterOn = false;

function startCount() {
    if (!counterOn) {
        coolCounter = setInterval(() => {
        number ++;
        document.getElementById("counterBox").textContent = number;
    }, 1000)
    }                                    
    counterOn = true;
}

function stopCount() {
    clearInterval(coolCounter);
    counterOn = false;
}

function zeroNumber() {
    clearInterval(coolCounter);
    counterOn = false;
    number = 0;
    document.getElementById("counterBox").textContent = number;
}

document.getElementById("startCounter").addEventListener("click", startCount);
document.getElementById("stopCounter").addEventListener("click", stopCount);
document.getElementById("backToZero").addEventListener("click", zeroNumber);
</pre>
                            </details>
                        </div>
                    </dd>

                </dl> 
                <a href="#top"><hr></a>
            </article>

            <article id="example-calendar">
                <h2>Calendar date and time</h2>
                <dl>
                    <dt>Calender updated each second</dt>
                    <dd>
                        <div class="js-resultbox">
                            <div class="calendar">
                                <span id="currentDay" style="margin: auto;"></span>
                            </div>
                            <div class="calendar">
                                <span id="currentDate"></span> <span id="currentMonth"></span> <span id="currentYear"></span>
                            </div>
                            <div class="calendar">
                                <span id="currentHour"></span> : <span id="currentMinute"></span> : <span id="currentSecond"></span>
                            </div>
                        </div>
                        <script>    
                            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                            const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

                            function getName (array, index) {
                                return array[index];
                            }

                            function updateDisplay1() {
                                const timeStamp = new Date();
                                document.getElementById("currentSecond").textContent = timeStamp.getSeconds();
                                document.getElementById("currentMinute").textContent = timeStamp.getMinutes();
                                document.getElementById("currentHour").textContent = timeStamp.getHours();
                                document.getElementById("currentDate").textContent = timeStamp.getDate();
                                document.getElementById("currentMonth").textContent = getName(months, timeStamp.getMonth());
                                document.getElementById("currentYear").textContent = timeStamp.getFullYear();
                                document.getElementById("currentDay").textContent = getName(days, timeStamp.getDay());
                            }

                            const calendarDisplay = [
                                { id: "currentSecond", content: (timeStamp) => timeStamp.getSeconds()},
                                { id: "currentMinute", content: (timeStamp) => timeStamp.getMinutes()},
                                { id: "currentHour", content: (timeStamp) => timeStamp.getHours()},
                                { id: "currentDate", content: (timeStamp) => timeStamp.getDate()},
                                { id: "currentMonth", content: (timeStamp) => getName(months, timeStamp.getMonth())},
                                { id: "currentYear", content: (timeStamp) => timeStamp.getFullYear()},
                                { id: "currentDay", content: (timeStamp) => getName(days, timeStamp.getDay())},
                            ]

                            function updateDisplay2() {
                                const timeStamp = new Date();
                                calendarDisplay.forEach(element => {
                                    document.getElementById(element.id).textContent = element.content(timeStamp);
                                })
                            }

                            updateDisplay2();
                            setInterval(updateDisplay2, 1000);
                        </script>
                        <div class="js-resultbox">
                            <details>
                                <summary>HTML Codes</summary>
<pre>
&lt;div class="calendar"&gt;
    &lt;span id="currentDay" style="margin: auto;"&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class="calendar"&gt;
    &lt;span id="currentDate"&gt;&lt;/span&gt; &lt;span id="currentMonth"&gt;&lt;/span&gt; &lt;span id="currentYear"&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class="calendar"&gt;
    &lt;span id="currentHour"&gt;&lt;/span&gt; : &lt;span id="currentMinute"&gt;&lt;/span&gt; : &lt;span id="currentSecond"&gt;&lt;/span&gt;
&lt;/div&gt;  
</pre>
                            </details>
                            <details>
                                <summary>JS Codes</summary>
<pre>
const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

function getName (array, index) {
    return array[index];
}

<b>Alternative 1: Direct HTML element assignments</b>
function updateDisplay1() {
    const timeStamp = new Date();
    document.getElementById("currentSecond").textContent = timeStamp.getSeconds();
    document.getElementById("currentMinute").textContent = timeStamp.getMinutes();
    document.getElementById("currentHour").textContent = timeStamp.getHours();
    document.getElementById("currentDate").textContent = timeStamp.getDate();
    document.getElementById("currentMonth").textContent = getName(months, timeStamp.getMonth());
    document.getElementById("currentYear").textContent = timeStamp.getFullYear();
    document.getElementById("currentDay").textContent = getName(days, timeStamp.getDay());
}

updateDisplay1();
setInterval(updateDisplay1, 1000);

<b>Alternative 2: HTML element assignments through array</b>
const calendarDisplay = [
    { id: "currentSecond", content: (timeStamp) => timeStamp.getSeconds()},
    { id: "currentMinute", content: (timeStamp) => timeStamp.getMinutes()},
    { id: "currentHour", content: (timeStamp) => timeStamp.getHours()},
    { id: "currentDate", content: (timeStamp) => timeStamp.getDate()},
    { id: "currentMonth", content: (timeStamp) => getName(months, timeStamp.getMonth())},
    { id: "currentYear", content: (timeStamp) => timeStamp.getFullYear()},
    { id: "currentDay", content: (timeStamp) => getName(days, timeStamp.getDay())},
]

function updateDisplay2() {
    const timeStamp = new Date();
    calendarDisplay.forEach(element => {
        document.getElementById(element.id).textContent = element.content(timeStamp);
    })
}

updateDisplay2();
setInterval(updateDisplay2, 1000);
</pre>
                            </details>
                            
                        </div>
                    </dd>
                </dl> 
                <a href="#top"><hr></a>
            </article>

            <article id="example-print-number">
                <h2>Print number every second</h2>
                <dl>
                    <dt><code>printNumber(from, to)</code></dt>
                    <dd>Output: a number every second starting from  <code>from</code> ending with <code>to</code></dd>
                    <dd>
<pre class="formula-thin">
function printNumbers(from, to) {
    let interId = setInterval(() => {
        console.log(from);
        from++;
        if (from > to) {
            clearInterval(interId);
        }
    }, 1000)
};
</pre>
                    </dd>
                    <dd>Result</dd>
                    <dd>
<pre class="formula-thin">
printNumbers(154647, 154651);

154647
154648
154649
154650
154651
</pre>  
                    </dd>
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="this">
                <h2>"this"</h2>
                <dl>    
                    <dt><code>this</code> context</dt>
                    <dd>Code executed by <code>setTimeout()</code> is called from an execution context separate from the function from which <code>setTimeout</code> was called.</dd>
                    <dd><code>this</code> keyword mut be set in the call or with <code>bind</code>, ot it will default to the <code>window</code> (or <code>global</code>) object. It will not be the same as the <code>this</code> value for function that called <code>setTimeout</code></dd>
                    <dd>Also can't pass <code>thisArg</code> like in array methods like <code>forEach()</code> and <code>reduce().</code></dd>

                    <dd><code>this</code> in usual situation</dd>
                    <dd>
<pre class="formula-thin">
const students = ['Abe', 'Ben', 'Che'];
students.printName = function (el) {
  console.log(arguments.length > 0 ? this[el] : this);
};

students.printName();    // (3) ['Abe', 'Ben', 'Che', printName: ƒ]
students.printName(0);   // Abe

</pre>
                    </dd>

                    <dd><code>this</code> in <code>setTimeout</code></dd>
                    <dd>
<pre class="formula-thin">
setTimeout(students.printName, 1000);
setTimeout(students.printName, 2000, 0);
setTimeout(students.printName, 3000, "0");
</pre>
                    </dd>
                    <dd>Results</dd>
                    <dd>
<pre class="formula-thin">
After 1 second:  object Window {window: Window, ...
After 2 seconds: undefined
After 3 seconds: undefined
</pre>
                    </dd>
                    <dd>Because when it's called, <code>this</code> is not set, so the default (window) is used.</dd>
                    
                    <dt>Leave this for future work</dt>

                    <dd>Continue reading: <a href="https://developer.mozilla.org/en-US/docs/Web/API/setTimeout#:~:text=Copy%20to%20Clipboard-,Solutions,-USE%20A%20WRAPPER" target="_blank">MDN</a></dd>
                    
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="example-promise-timer">
                <h2>Example: Promise timer</h2>
                <dl>     
                    <dt>About</dt>
                    <dd>Timer with counter and cancel button. Promise is used to allow ringer alert appears after counter result.</dd>

                    <dt>Why promise?</dt>
                    <dd>In previous example, the ringer can't be delivered using <code>alert</code> box because in Javascript, there's a priority for alert box over HTML manipulation. Resulting in the last counter result didn't appear in the paragraph, despite counter coded prior to alert. To force alert to wait, we are going to use <code>promise</code> method.
                        <ul>
                            <li>Promise: <code>setInterval</code> is finished.</li>
                            <li>Then: alert can run.</li>
                        </ul>
                    </dd>

                    <dt>Methods featured</dt>
                    <dd>
                        <ul>
                            <li><code>Promise</code></li>
                            <li><code>setTimeout</code></li>
                            <li><code>setInterval</code></li>
                            <li><code>clearTimeout</code></li>
                            <li><code>clearInterval</code></li>
                        </ul>
                    </dd>

                    <dt>Leave this for future work</dt>
                </dl>
                <a href="#top"><hr></a>
            </article>

            <article id="references">
                <h2>References</h2>
                <ul>
                    <li><a href="https://javascript.info/settimeout-setinterval" target="_blank">Javascript.info: Scheduling: setTimeout and setInterval</a></li>
                    <li><a hreef="https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers" target="_blank">HTML: 8.6 Timers</a></li>
                    <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/setTimeout" target="_blank">MDN: setTimeout()</a></li>
                </ul>
            </article>
        </main>
        <footer>
            <div class="nav-bar"><a href="./index.html" class="nav-button-rev" style="margin: auto">Home</a></div>
        </footer>
        <script src="./navArticle.js"></script>
    </body>
</html>

